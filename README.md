<div align="center">
  <img src="./icon-512.png" alt="项目Logo" width="100" />
  <h1>D&D战斗助手 (D&D Combat Assistant)</h1>
  <p><strong>一款为现代DM打造的、完全本地化、功能强大且响应迅速的D&D战斗辅助工具。</strong></p>
  
  <p>
    <img alt="Vue.js" src="https://img.shields.io/badge/Vue.js-3-4FC08D?style=for-the-badge&logo=vue.js">
    <img alt="Local-First" src="https://img.shields.io/badge/Data-Local First-F7DF1E?style=for-the-badge&logo=javascript">
    <img alt="PWA Ready" src="https://img.shields.io/badge/PWA-Ready-5A0FC8?style=for-the-badge&logo=pwa">
    <img alt="License" src="https://img.shields.io/badge/License-MIT-blue.svg?style=for-the-badge">
  </p>
</div>

---

> 🏰 *“当巨龙的阴影笼罩村庄，当哥布林的号角在山谷回响，当深渊的触须悄然爬上你的脚踝…… 你，伟大的地下城主，是否还在为成堆的怪物卡、混乱的先攻序列和繁琐的伤害计算而烦恼？”*

别再挣扎了，冒险者！**D&D战斗助手** 就是你一直在寻找的神器。它不是又一个需要注册、需要联网、需要付费的云端服务。它是一个纯粹、强大、完全属于你的本地王国。你的所有数据——你亲手创造的怪物、你精心设计的PC、每一场惊心动魄的战斗记录——都安全地沉睡在你浏览器的 IndexedDB 神殿中，等待你的随时唤醒。

这款工具由一位同样热爱 D&D 的全栈工程师倾力打造，旨在将现代 Web 技术的流畅与优雅，注入到古老而伟大的桌面角色扮演游戏中。我们的核心理念是：**快、私密、高度可定制**。

## ✨ 项目核心特性一览

*   **📦 全功能生物数据库 (Comprehensive Creature Database):**
    *   强大的**怪物库**，支持按名称、CR、类型进行多维度筛选。
    *   独立的**PC角色库**，轻松管理你的英雄伙伴。
    *   内置**动作库**，将通用或独特的攻击、法术、能力模块化，方便复用。

*   **⚔️ 自动化与智能化的战斗流程 (Automated & Intelligent Combat Flow):**
    *   **一键掷先攻**并自动按规则排序（自然20优先！）。
    *   **拖拽式先攻条**，战局变化尽在掌控。
    *   **高度自动化的动作执行**：选择动作、点选目标、一键执行！系统自动完成命中检定（支持优劣势）、重击/大失败判定、伤害掷骰与计算。
    *   **智能伤害处理**：自动应用目标的**易伤（Vulnerability）**、**抗性（Resistance）**和**免疫（Immunity）**。
    *   **完善的豁免检定（Saving Throw）流程**：无论是龙息还是火球术，都能通过直观的豁免选择器轻松处理范围伤害。
    *   **状态与冷却管理**：自动追踪状态（如中毒、束缚）的持续回合，并在回合开始时自动-1；动作的充能（Recharge）与冷却（Cooldown）同样会自动管理。

*   **🎨 深度定制与视觉化体验 (Deep Customization & Visual Experience):**
    *   **强大的生物编辑器**：从基础属性到复杂的伤害抗性，再到私有动作库，一切皆可定制。
    *   **头像与背景自定义**：为你的怪物和PC上传专属的头像和背景图片，内置的**图片裁剪工具**让排版更美观，极大增强代入感！
    *   **华丽的战斗演出**：重击、大失败、命中、未命中均有专门设计的**全屏动画通知**，让每一次关键检定都充满仪式感。

*   **🔒 100%本地优先，离线可用 (100% Local-First & Offline Ready):**
    *   **你的数据，你做主**。所有信息存储在本地浏览器，绝不上传任何服务器。
    *   **PWA（渐进式Web应用）支持**：可“安装”到桌面或手机主屏幕，享受原生应用般的体验，并且**完全支持离线使用**。断网？战斗永不停歇！
    *   **全量数据导入/导出**：通过 JSON 文件轻松备份和恢复你的整个数据库。

*   **🚀 为效率而生的快捷操作 (Designed for Efficiency):**
    *   **快捷键支持**：双击 `D` 键快速投骰，双击 `→` / `←` 切换上下回合。
    *   **怪物组合出战**：预设“哥布林巡逻队”、“兽人突袭小队”等怪物组合，一键将整队敌人加入战场！
    *   **便捷的UI交互**：点击头像快速扣血，多选目标一键清空，常用操作触手可及。

---

## 🚀 如何开始你的冒险？

### 方式一：在线访问 (最简单！)

1.  访问我们的线上部署地址：[**点击这里进入你的D&D世界**](https://tyyf-dnd-helper.pages.dev/)
2.  **（强烈推荐）安装为桌面应用**：
    *   **PC端 (Chrome/Edge):** 地址栏右侧会出现一个“安装”图标（通常是一个屏幕加一个向下的箭头）。点击它，即可将本工具作为独立应用安装到你的电脑上。
    *   **移动端 (iOS/Android):** 使用浏览器的“添加到主屏幕”功能，即可拥有一个无浏览器边框的、沉浸式的App体验。

### 方式二：本地部署 (开发者/极客之选)

如果你想对代码进行二次开发，或者希望在完全隔离的环境下运行：

1.  克隆本仓库到本地:
    ```bash
    git clone https://github.com/your-username/your-repo.git
    ```
2.  进入项目目录:
    ```bash
    cd your-repo
    ```
3.  由于本项目是一个纯前端应用，你不需要复杂的构建过程。只需一个简单的本地服务器来托管这些静态文件即可。推荐使用 `http-server` 或 VS Code 的 `Live Server` 插件。
    *   **使用 http-server:**
        ```bash
        # 如果你没有安装过 http-server
        npm install -g http-server
        # 在项目根目录运行
        http-server
        ```
    *   **使用 Live Server:** 在 VS Code 中打开项目文件夹，右键点击 `index.html` 并选择 `Open with Live Server`。

---

## 🗺️ 宏大的旅程：详细使用指南

欢迎来到新手村！接下来，我们将一步步带你探索这个世界的每一个角落。

### 1. 怪物库：驯养你的地下城 Lair of Creatures 👹

这是你的生物研究室。所有敌人都将从这里诞生。

*   **浏览与筛选**：主界面以卡片形式展示所有怪物。顶部的工具栏是你的指挥中心：
    *   **按名称搜索**：快速找到你想要的“地精”或“青年黑龙”。
    *   **按CR筛选**：为你的队伍匹配实力相当的挑战。
    *   **按类型筛选**：想来一场“不死生物”主题的战役？点这里就对了。

*   **创建/编辑怪物（核心功能）**：
    1.  点击“+ 新建怪物”或任一怪物卡片下的“详情/伪编辑”进入编辑器。
    2.  编辑器分为**查看模式**和**编辑模式**。查看模式以类似官方怪物图鉴的样式展示数据，更具沉浸感；编辑模式则提供了详尽的表单。
    3.  **基础信息**：
        *   **头像与背景**：点击默认头像或“上传背景”按钮，从本地选择图片。系统会弹出**裁剪工具**，让你轻松截取完美区域。头像会被裁剪为圆形，背景图则按比例裁剪，它们将极大地提升战斗时的视觉效果。
        *   **核心属性**：填写名称、CR、AC、HP（平均值）、速度等。
        *   **类型**：点击选择一个或多个生物类型，如“人形生物”、“类哥布林”。
    4.  **六大属性**：直观地输入怪物的力量、敏捷、体质、智力、感知、魅力值，调整值会自动计算。
    5.  **抗性/易伤/免疫**：通过点击标签的方式，轻松为怪物添加对不同伤害类型（火焰、钝击等）或状态（魅惑、恐慌等）的修正。
    6.  **动作与能力（关键！）**：
        *   点击“管理动作”按钮，会弹出一个专属于此怪物的“私有动作库”窗口。
        *   你可以“**+ 新建私有动作**”，为其量身定做独一无二的能力。
        *   也可以从“**动作库**”或“**能力池**”中，将预设好的通用能力（如“多重攻击”或“再生”）添加进来。这大大提高了效率！
    7.  **CR一键调整（实验性）**：在“CR一键调整”区域输入一个目标CR，点击“调整”，系统会根据一套（目前简化的）算法，自动调整怪物的AC、HP、攻击加值和伤害骰。这是快速生成精英或模板怪物的利器！
    8.  **保存**：
        *   **更改并关闭**：如果你在编辑一个已存在的怪物，此操作会覆盖原数据。
        *   **另存为自定义**：无论你是在新建还是编辑，此操作都会创造一个全新的、标记为“自定义”的怪物。这是保护原始数据不被修改的最佳方式。

### 2. PC角色库 & 动作库：英雄与他们的武艺 🛡️⚔️

*   **PC角色库**：管理玩家角色。其编辑器与怪物编辑器类似，但更侧重于PC的特性，如最大/当前生命值、特性描述等。同样支持自定义头像和私有动作库。
*   **动作库**：这是一个**全局的动作/能力模板库**。你可以在这里预先创建好各种常见的攻击方式（如“长剑”、“火箭”）、豁免类法术（如“燃烧之手”）和特殊能力（如“灵巧闪避”）。在编辑怪物或PC时，就可以非常方便地从这里一键添加，无需重复输入。

### 3. 战斗！荣耀归于勇者！(The Battle Arena) 🎲

这里是所有准备工作的终点，也是传奇开始的地方。

#### **第一幕：战前准备**

1.  **添加参战者**：
    *   点击左上角的“+ 添加单位”按钮。
    *   在弹出的窗口中，你可以从**怪物库**、**PC库**或**怪物组合**中添加单位。
    *   对于怪物，可以指定添加的数量，同名怪物会自动编号（如“哥布林 #1”, “哥布林 #2”）。
    *   **怪物组合**：这是一个非常强大的功能！在怪物库页面，点击“设置组合出战”，可以预先创建好一个遭遇，比如“地精巢穴守卫” = 4个地精 + 1个大地精。之后在添加单位时，只需点击一下这个组合，就能将所有成员一次性加入战场！
2.  **掷先攻**：
    *   所有单位就位后，点击“掷先攻”。系统会为每个单位自动投掷d20并加上其敏捷调整值，然后按照D&D规则进行排序。
    *   顶部的**先攻条**会立刻更新。当前行动者的卡片会有醒目的**脉冲光晕高亮**，让你对战局一目了然。
    *   需要手动调整顺序？直接**拖拽**卡片即可！

#### **第二幕：回合流程**

战斗以回合制进行。左侧是**当前行动者面板**，右侧是**战场总览与目标选择器**。

1.  **轮到你了 (左侧面板)**：
    *   面板顶部清晰地展示了当前行动者的头像、名称、AC和HP。
    *   **HP管理**：可以直接在输入框中输入伤害/治疗数值（如 `15`），然后点击“应用”扣血，“治疗”加血，或“半伤”、“双倍”来快速处理伤害。
    *   **状态管理**：
        *   点击“+ 施加状态”，可以选择一个状态（如“倒地 Prone”）、设定持续回合数，并应用到当前行动者身上。
        *   行动者身上的所有状态会以图标和剩余回合数的形式显示。每当轮到该行动者行动时，所有状态的持续时间会自动减少1。
    *   **选择动作**：下方会列出该行动者所有的可用动作。被选中的动作会高亮，其详细信息和自动化流程工具会随之出现。如果一个动作处于冷却中，它会显示剩余回合数并且不可点击。

2.  **选择目标 (右侧面板)**：
    *   右侧面板以分组（PC/怪物）的形式列出了战场上所有的单位。
    *   **单击**任一单位的卡片即可将其选为目标（或取消选择）。被选中的单位卡片会有明显的红色边框。
    *   你可以**多选**任意数量的目标。
    *   点击分组标题旁的“选择组”按钮，可以一键选中该组的所有成员，非常适合处理范围效果！

3.  **执行动作！**
    *   在左侧面板的“自动化攻击流程”区域，你可以为本次动作选择掷骰模式（**无/优势/劣势**），并决定是否**自动扣血**。
    *   一切就绪后，点击红色的“**执行 [动作名]**”按钮！
    *   **见证奇迹的时刻**：
        *   **攻击检定**：系统会立即为你投掷d20，加上攻击加值，并与每个目标的AC进行比较。
            *   **命中**：会出现一个详细的**命中通知**，展示你的命中检定过程 (`d20(x) + bonus = result`)、目标的AC、伤害表达式、伤害掷骰过程 (`(rolls) + flat = raw damage`)，以及考虑了抗性/易伤后的最终伤害。
            *   **未命中**：会出现一个简洁的**未命中通知**，告诉你差之毫厘。
            *   **重击 (Critical Hit) / 大失败 (Fumble)**：会出现华丽的**全屏动画**，宣告这决定性的瞬间！重击时，伤害骰会自动翻倍。
        *   **豁免检定**：如果动作是豁免类的（如龙息），系统会弹出**豁免结果选择器**。
            *   选择器会列出所有目标。
            *   你只需为每个目标选择“豁免失败”、“伤害减半”或“伤害全免”。
            *   点击“确认并应用结果”，系统会根据你的选择和怪物的抗性等，为每个目标计算并应用最终伤害。
    *   **战斗日志**：所有检定、伤害、状态变化的过程都会以文本形式记录在下方的日志区域，方便追溯。

4.  **结束回合**：
    *   点击“下一个”按钮，高亮会移动到先攻条的下一个单位。
    *   系统会自动处理回合结束的逻辑：
        *   生命值降到0的怪物会被标记为“已击败”，并在其回合结束后自动从战场移除。
        *   新行动者的状态持续时间会更新。
        *   所有单位的动作冷却时间会减少1。

### 4. 数据管理与其他功能 ⚙️

*   **导入/导出**：在“导入/导出”标签页，你可以一键将所有数据（怪物、PC、动作、组合）导出为一个 JSON 文件。这是你的**“世界之种”**，请妥善保管！你可以用它来备份、在不同电脑间迁移数据，或者与朋友分享你的创造。
*   **快捷投骰**：在战斗界面，快速连按两下键盘上的 `D` 键，会弹出一个快捷投骰窗口。输入任意表达式（如 `2d8+1d6+5`），回车即可看到详细的投骰结果。
*   **主题切换**：标题栏的“切换主题”按钮目前是一个占位符，但它为未来的光明/黑暗模式切换留下了想象空间。

---

## 🛠️ 技术内幕 (For the Nerds)

本项目是对现代前端技术的一次有趣实践，其核心架构如下：

*   **视图层 (View)**: 使用 **Vue 3** 构建，并全面拥抱 **Composition API**。这种模式让代码逻辑更内聚、可复用性更高。整个应用的响应式系统都由 Vue 的 `ref`, `reactive`, `computed` 等核心API驱动。
*   **状态管理 (State)**: 我们没有引入 Vuex 或 Pinia，而是采用了一种更轻量级的方式。`js/modules/state.js` 文件导出了一个巨大的 `reactive` 对象 `ui` 和多个 `ref` 对象，它们作为全局的、单一的数据源 (Single Source of Truth)，被各个组件共享。这种方式在本项目的中等规模下非常清晰和高效。
*   **数据持久化 (Persistence)**: **Dexie.js** 是对 IndexedDB 的一个优雅封装。我们在 `js/modules/db.js` 中定义了数据库的结构（表和索引），并提供了初始数据填充（seed）的逻辑。所有对数据的增删改查都通过 Dexie 的 Promise-based API 完成，既强大又易于理解。
*   **模块化 (Modularity)**: 项目代码被精心组织在 `js/modules/` 目录下，每个文件各司其职：`constants.js` 存放常量，`utils.js` 存放工具函数，`state.js` 负责全局状态，`db.js` 处理数据库，`main.js` 则是将所有部分组装起来的应用入口。
*   **离线能力 (Offline)**: `sw.js` (Service Worker) 文件是实现PWA离线功能的核心。它会在应用安装时缓存所有核心资源（HTML, CSS, JS等）。之后，即使用户在离线状态下访问，Service Worker 也会拦截请求，并从缓存中返回资源，确保应用可用。

---

## 🛣️ 未来的蓝图 (Roadmap)

这个项目还有广阔的成长空间，以下是我们计划在未来版本中探索的一些方向：

*   [ ] **更完善的怪物图鉴视图**：在查看模式下，模仿官方《怪物图鉴》的排版，提供更具沉浸感的阅读体验。
*   [ ] **智能CR调整算法V2**：引入更精确的DMG攻防等级对照表，实现更智能、更符合规则的CR scaling。
*   [ ] **法术库与法术位追踪**：为施法者PC和怪物添加法术列表，并为PC提供法术位追踪功能。
*   [ ] **战役与地图管理**：提供简单的战役笔记功能，甚至可能集成一个基础的网格地图工具。
*   [ ] **移动端优化**：针对手机等小屏幕设备进行更深入的布局优化。
*   [ ] **主题系统**：实现完整的光明/黑暗主题切换，甚至允许用户自定义主题色。

---

## 🤝 如何贡献

我们欢迎任何形式的贡献！无论是提交 Bug 报告、提出功能建议，还是直接贡献代码，都会让这个项目变得更好。

1.  **发现问题？** 请通过 GitHub Issues 提交详细的 Bug 报告。
2.  **有好点子？** 同样欢迎通过 Issues 提交功能请求。
3.  **想写代码？**
    *   Fork 本仓库。
    *   创建一个新的分支 (`git checkout -b feature/AmazingFeature`)。
    *   进行你的修改。
    *   提交你的更改 (`git commit -m 'Add some AmazingFeature'`)。
    *   Push 到你的分支 (`git push origin feature/AmazingFeature`)。
    *   开启一个 Pull Request。

---

## 📜 许可协议

本项目采用 [MIT License](LICENSE.txt) 授权。

---

<div align="center">
  <p><strong>愿你的骰子永远投出20，愿你的冒险永不落幕！</strong></p>
</div>