# DND 战斗辅助工具 (DND Combat Assistant)

让 DM 在战斗中少算数、多讲故事 🧙‍♂️⚔️

![版本](https://img.shields.io/badge/version-v0.4.1-blue)
![技术栈](https://img.shields.io/badge/tech-Vue.js_|_Dexie.js-brightgreen)
![许可](https://img.shields.io/badge/license-MIT-lightgrey)
![状态](https://img.shields.io/badge/status-active-success)
![离线](https://img.shields.io/badge/offline-supported-orange)
![PWA](https://img.shields.io/badge/PWA-ready-informational)

一款功能强大的、纯本地运行的《龙与地下城》(D&D) 战斗辅助工具。它旨在帮助地下城主 (DM) 轻松管理怪物、玩家角色 (PC) 与复杂的战斗流程。所有数据均存储在浏览器的 IndexedDB 中，无需联网，支持完全离线使用与安装到桌面/手机（PWA）。

---

## 目录

- 概览与亮点
- 功能详解
- 界面预览
- 快速开始
- 安装为桌面/移动应用
- 使用指南
- 数据与隐私
- 技术栈
- 常见问题（FAQ）
- 未来计划（Roadmap）
- 贡献
- 许可

---

## 🌟 概览与亮点

- 100% 本地优先：无需后端，数据私有且持久保存。
- 一键战斗节奏：自动先攻、命中判断、伤害结算、抗性/易伤/免疫生效。
- 可视化反馈：重击/失手等结果以动画/弹窗高亮呈现。
- 高效资料库：怪物、PC、动作可自由创建与复用，支持预设组合一键上阵。
- PWA 支持：离线可用，安装到桌面，像原生应用一样顺滑。

### 功能总览（速览表）

| 模块 | 你可以做什么 | 亮点 |
|---|---|---|
| 资料库管理 | 管理怪物、PC、公共动作 | 名称/CR/类型筛选，动作可复用 |
| 自定义生物 | 编辑 AC、HP（平均/生命骰）、速度、六维、抗性/易伤/免疫、状态免疫 | 支持头像/背景上传与裁剪 |
| 战斗流程 | 先攻、回合推进、选择目标、执行动作 | 自动掷骰（优势/劣势）、命中/重击判断 |
| 伤害结算 | 自动计算伤害并应用抗性/易伤/免疫 | 结果日志与弹窗动画反馈 |
| 状态与冷却 | 持续时间自动-1，到期移除；动作冷却计时 | 开始回合自动处理持续时间 |
| 数据与设置 | Dexie.js 本地存储、导入/导出 JSON | 预设组合出战；PWA 离线缓存 |

---

## 🧰 功能详解

### 📚 资料库管理
- 怪物库：创建、编辑、复制、删除；按名称、CR、类型筛选。
- PC 角色库：维护核心数据，战斗中统一管理。
- 动作库：构建可复用的攻击、豁免、能力等动作模板，创建生物时可直接引用。
- 自定义生物细节：
  - 基础属性：AC、HP（平均值/生命骰）、速度、六大属性值。
  - 战斗特性：伤害抗性、易伤、免疫，以及状态免疫。
  - 外观个性化：上传并裁剪头像和背景，让关键单位更具辨识度。

### ⚔️ 智能战斗流程
- 先攻列表：直观顶部先攻条，一键掷先攻并自动排序；支持拖拽调整。
- 回合推进：显示当前回合数；“上一个/下一个”快速切换行动者。
  > 小贴士：在战斗中点击左下方当前生物的头像可以快速查看；点击右下方战场总览的头像可快速扣血
- 自动化攻击：
  - 目标选择：右侧战场总览中选择单个或多个目标。
  - 掷骰逻辑：正常/优势/劣势攻击；自动判断命中、失手、重击。
    > 小贴士：双击“d”键可以快速投骰子
  - 伤害计算：自动掷伤害骰，依据目标抗性等自动计算最终伤害。
  - 视觉反馈：重击/失手/命中详情以弹窗与动画高亮展示。
- 状态与冷却：
  - 持续时间：为角色施加带持续时间的状态，回合开始时自动 -1。
  - 动作冷却：使用后自动进入冷却并计时，到点可用。

  

  

### ⚙️ 数据与设置
- 本地优先：借助 Dexie.js 将数据存入 IndexedDB；私有、安全、持久。
- 导入/导出：一键导出怪物、PC、动作与预设组合为 JSON，便于备份/迁移/分享。
- 组合出战：为常见遭遇（如“哥布林巡逻队”）创建预设，战斗开始时一键上阵。
- PWA 支持：可添加到桌面或主屏幕，离线可用，近似原生体验。

---

## 🚀 快速开始

你可以直接用浏览器打开，或通过本地服务器运行（推荐）。后者能获得更完整的 PWA/离线体验。

### 方法一：直接打开（最简单）
1. 下载本仓库所有文件至本地。
2. 使用现代浏览器（Chrome / Firefox / Edge）打开 `index.html`。

> 注意：直接以 file:// 打开无法启用 Service Worker，因此无法安装为 PWA，且离线缓存能力受限。若要完整体验，请使用方法二。

### 方法二：本地服务器（推荐）
1. 安装 [Node.js](https://nodejs.org/)（推荐）或 [Python 3](https://www.python.org/downloads/)。
2. 将项目下载/解压至任意文件夹并在该目录打开终端。
3. 运行以下任一命令：
   - 使用 Node.js（推荐）：
     ```bash
     npx serve
     ```
   - 使用 Python 3：
     ```bash
     python -m http.server
     ```
4. 打开浏览器，访问终端显示的地址（如 `http://localhost:3000` 或 `http://localhost:8000`）。

---

## 📲 安装为桌面/移动应用（PWA）

- 在 Chrome 或 Edge 访问本应用时，地址栏右侧会出现“安装”图标。点击即可安装为独立应用。
- 移动端（Android Chrome）：点击“添加到主屏幕”，离线也可打开使用（目前没有对移动端进行优化）。

> 需要通过 http(s) 服务访问页面（或 localhost）才能安装；直接打开本地文件不支持 PWA。

---

## 📖 使用指南

以下步骤将带你从零到一场完整的战斗：

1) 初始化
- 进入「怪物库」页面，如果没有任何角色卡请点击「载入演示数据」快速体验。
- 或者从零开始新建你自己的怪物、PC 与动作模板。

2) 创建资料
- 在「怪物库」与「PC 角色库」创建战斗单位。
- 在「动作库」配置常用攻击/能力，后续在任意生物中复用。

3) 准备战斗
- 切换到「战斗」标签页。
- 点击「+ 添加单位」，从资料库选择怪物和 PC 加入战场。
- 可使用「组合出战」一键添加预设遭遇（如成队敌人）。

4) 开始战斗
- 点击「掷先攻」，系统自动按先攻值排序。
- 点击「下一个」开始回合。当前行动者详情显示在左侧。
  > 小贴士：快速按两下键盘上“上下左右”的“左”/“右”键 === 点击了“上一个”/“下一个”

5) 执行动作
- 在左侧为当前行动者选择一个动作。
- 在右侧战场总览中选择一个或多个目标（选中项会高亮）。
- 点击「执行 [动作名]」，系统将自动进行：
  - 掷命中（含优势/劣势）→ 判断命中/重击/未命中
  - 掷伤害 → 应用目标的抗性/易伤/免疫
  - 以弹窗与日志展示结果

6) 管理战斗
- 随时手动调整单位 HP、添加/移除状态、拖拽修改先攻顺序。
- 当怪物 HP 降至 0，其回合结束后会自动移除。

> 小贴士：回合开始时，带持续时间的状态会自动 -1；具有冷却的动作会在使用后自动进入冷却并计时。

---

## 🔐 数据与隐私

- 存储位置：所有数据存放在浏览器的 IndexedDB（通过 Dexie.js）中。
- 导入/导出：支持将全部数据打包为单个 JSON 文件，便于备份或迁移。
- 隐私说明：本应用无服务器、无埋点；你的数据仅存在于本地浏览器内。
- 建议：定期导出数据备份；清理浏览器数据会删除 IndexedDB 中的记录。

---

## 🛠️ 技术栈

- 前端框架：Vue.js 3（Composition API）
- 本地数据库：Dexie.js（IndexedDB 友好封装）
- 应用形态：纯客户端渲染、PWA（Service Worker + Manifest）
- 样式与逻辑：原生 CSS（CSS 变量）、原生 JavaScript（ES6+）

> 备注：项目为纯静态站点，无需后端与复杂构建流程。

---

## ❓ 常见问题（FAQ）

- Q：为什么我看不到“安装”按钮？
  - A：需要通过 http(s) 服务访问页面（或 localhost）。直接打开本地文件（file://）无法启用 Service Worker。

- Q：数据会不会丢？
  - A：数据存放在浏览器本地。清理站点数据/更换浏览器/无痕模式可能导致不可用或丢失。请定期使用导出功能备份。

- Q：可以多设备同步吗？
  - A：当前不支持云同步。你可以在设备 A 导出 JSON，再在设备 B 导入实现迁移。

- Q：支持哪些浏览器？
  - A：现代浏览器（Chrome / Edge / Firefox 的近期版本）。Safari 对部分 API 的支持较慢，若遇问题请更新版本或更换浏览器。

---

## 📝 未来计划（Roadmap）

- [ ] 浅色主题（Light Mode）
- [ ] 图鉴式排版：更贴近官方怪物图鉴的浏览体验
- [ ] CR 调整算法：更智能、贴规则的数值一键生成
- [ ] 战场网格/标记功能
- [ ] 内置帮助与悬浮提示（Tooltip/Help）
- [ ] 移动端优化
- [ ] 多语言支持

> 欢迎在 Issue 中补充你希望优先实现的功能，我们会据此调整优先级。

---

## 🤝 贡献

非常欢迎你的参与！无论是功能建议、问题反馈，还是直接提交代码，都是对项目的巨大帮助。

- 准备：
  - Fork 本仓库并创建你的分支
  - 提交前请尽量附上截图/GIF 或复现步骤
- 提交：
  - 发起 Pull Request 并清晰描述改动动机与影响范围
  - 也可以直接创建 Issue 进行讨论

---

## 📄 许可

本项目基于 MIT License 开源。详见 [LICENSE](LICENSE)。